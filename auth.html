<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<title>ログイン</title>
<link rel="icon" href="https://mikatea.sakura.ne.jp/Adeline/auth/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="./auth_style.css">
<style>
    .form-container{max-width:460px;margin:40px auto;background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08)}
    .form-container h2{text-align:center;margin:0 0 1.2rem}
    label{display:block;margin-top:1rem;font-weight:600}
    input[type="email"],input[type="password"]{width:100%;padding:.75rem;font-size:1rem;margin-top:.3rem;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
    .btn{margin-top:1rem;width:100%;background:#3F88C5;color:#fff;border:none;padding:.9rem;font-size:1.05rem;border-radius:8px;cursor:pointer;font-weight:700}
    .btn:hover{background:#316fa0}
    .btn-google{background:#4285f4}
    .btn-google:hover{background:#366fca}
    .row{display:flex;gap:8px;margin-top:8px}
    .row .btn{flex:1}
    .help{font-size:.9rem;color:#666;margin-top:.5rem;text-align:center}
    .error{margin-top:.75rem;color:#c0392b;font-weight:600}
    .success{margin-top:.75rem;color:#2e7d32;font-weight:600}
</style>
</head>

<body>
<main>
    <div class="form-container">
    <h2>🔐 ログイン</h2>

    <label>メール
        <input type="email" id="email" placeholder="you@example.com" required />
    </label>
    <label>パスワード
        <input type="password" id="password" placeholder="******" required />
    </label>

    <div class="row">
        <button id="loginBtn" class="btn">ログイン（Email/Password）</button>
        <!-- <button id="googleBtn" class="btn btn-google" type="button">Googleで続行</button> -->
    </div>

    <div class="row">
        <a class="btn" href="./reset.html" style="text-align:center;">パスワード再設定はこちら</a>
    </div>

    <div class="help">
        アカウント未作成？ <a href="./register.html">新規登録</a> /
        ホームへ <a href="../index/index.html">戻る</a>
    </div>
    <div id="msg"></div>
</div>
</main>

<!-- Firebase v10+ CDN（モジュール版） -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import {
    getAuth, onAuthStateChanged, signInWithEmailAndPassword,
    GoogleAuthProvider, signInWithPopup, sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

// ★githubアップ時に忘れず消すこと！★
const firebaseConfig = {
    apiKey: "",
    authDomain: "",
    projectId: "",
    storageBucket: "",
    messagingSenderId: "",
    appId: "",
    measurementId: ""
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
    
const msg = document.getElementById("msg");
const showMsg = (text, ok=false) => {
    msg.textContent = text;
    msg.className = ok ? "success" : "error";
};

// すでにログイン済みならホームへ
onAuthStateChanged(auth, user => { 
    if (user) location.href = "../start/start.html"; 
});


// Email/Password ログイン
document.getElementById("loginBtn").addEventListener("click", async () => {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    if (!email || !password) return showMsg("メールとパスワードを入力してください。");

    try {
        await signInWithEmailAndPassword(auth, email, password);
        location.href = "../start/start.html";
    } catch (e) {
        const map = {
            "auth/invalid-email": "メールの形式が不正です。",
            "auth/user-disabled": "このユーザーは無効化されています。",
            "auth/user-not-found": "ユーザーが見つかりません。",
            "auth/wrong-password": "パスワードが違います。",
        };
        showMsg(map[e.code] || `ログインに失敗しました：${e.code}`);
    }
});

</script>
</body>
</html>